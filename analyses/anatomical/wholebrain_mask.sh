#!/bin/bash

neuroglia fslmaths ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-001/anat/sub-001_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-002/anat/sub-002_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-003/anat/sub-003_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-004/anat/sub-004_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-005/anat/sub-005_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-006/anat/sub-006_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-007/anat/sub-007_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-008/anat/sub-008_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-011/anat/sub-011_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-013/anat/sub-013_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-014/anat/sub-014_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-016/anat/sub-016_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-020/anat/sub-020_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-021/anat/sub-021_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-022/anat/sub-022_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-026/anat/sub-026_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz -add  ~/scratch/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-095/anat/sub-095_space-MNI152NLin2009cAsym_desc-brain_mask.nii.gz ~/scratch/working_dir/PPC_MD/masks/17Ss_2mmMotionCor_testphase_MNI_avgMask.nii
#binarize the mask
neuroglia fslmaths ~/scratch/working_dir/PPC_MD/masks/17Ss_2mmMotionCor_testphase_MNI_avgMask.nii.gz -thr 0 -bin ~/scratch/working_dir/PPC_MD/masks/bin_17Ss_2mmMotionCor_testphase_MNI_avgMask.nii
#resample to functional resolution, all functional runs from all subjects have the same 3d dimensions in MNI, so just use sub-001 as a reference. This can be checked by comparing the mask generated with the line below with the one generated using keyprac run of sub-020 as the reference img, the two masks should be exactly the same
neuroglia reg_resample -ref /scratch/hyang336/working_dir/PPC_MD/fmriprep_1.5.4_corrected/fmriprep/sub-001/func/sub-001_task-keyprac_run-01_space-MNI152NLin2009cAsym_desc-preproc_bold.nii.gz -flo ~/scratch/working_dir/PPC_MD/masks/bin_17Ss_2mmMotionCor_testphase_MNI_avgMask.nii.gz -res ~/scratch/working_dir/PPC_MD/masks/func-res_bin_17Ss_2mmMotionCor_testphase_MNI_avgMask.nii -inter 0